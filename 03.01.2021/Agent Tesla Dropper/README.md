
# Malware Analysis Report N°1

**Date**: 03/01/2021

**Author/s**: Finch

(Due to my current lab limitations, behavioral information will be taken from various sandbox)

  * [Key observation](#key-observation)
  * [Indicators of compromise](#indicators-of-compromise)
  * [Delivery method](#delivery-method)
- [Sample indetification](#sample-indetification)
  * [File name, type, size](#file-name--type--size)
  * [File hashes](#file-hashes)
  * [Anti-virus indentifiers](#anti-virus-indentifiers)
- [Dependencies](#dependencies)
  * [Supported OS](#supported-os)
  * [Required libraries](#required-libraries)
  * [Configuration file/s](#configuration-file-s)
  * [Script/s and Executable/s](#script-s-and-executable-s)
  * [Url/s](#url-s)
- [Sample identification](#sample-identification)
  * [Infection capabilities](#infection-capabilities)
  * [Self-preservation capacity](#self-preservation-capacity)
  * [Data leakage abilities](#data-leakage-abilities)
  * [Remote attacker interactions / C&C](#remote-attacker-interactions---c-c)
- [Observations](#observations)
  * [Behavioral analysis](#behavioral-analysis)
  * [Code analysis](#code-analysis)
  * [Dynamic code analysis](#dynamic-code-analysis)
  * [Memory analysis](#memory-analysis)
- [Supporting figures](#supporting-figures)
  * [Logs](#logs)
  * [Strings](#strings)
  * [Function listings](#function-listings)
  * [Screenshots](#screenshots)
  * [Additional comments](#additional-comments)

# Summary of the analysis

## Key observation
The sample try to compromise the analysis by looking as a benign executable.
All the malicious actions are based on the resources of the executable.
![](https://github.com/Finch4/Malware-Analysis-Reports/blob/main/03.01.2021/Agent%20Tesla%20Dropper/resource1.PNG?raw=true)
![](https://github.com/Finch4/Malware-Analysis-Reports/blob/main/03.01.2021/Agent%20Tesla%20Dropper/resource2.PNG?raw=true)
## Indicators of compromise
The executable is compressed inside an archive named: "Pending Order Confirmation.gz
"
## Delivery method

The delivery is made by email

Email example(Thanks to [cocaman](https://bazaar.abuse.ch/user/1169961/ "cocaman")):

**From**: "Habibur Rahman <Info@habibur.rahman>" (likely spoofed)

**Received**: "from shared.safavisa.com (shared.safavisa.com [89.163.146.180]) "

**Date**: "Thu, 26 Nov 2020 02:14:30 +0100"

**Subject**: "Pending Order Confirmation"

**Attachment**: "Pending Order Confirmation.gz"


# Sample identification
## File name, type, size

**File name**: Pending Order Confirmation.exe

**Type**: .NET

**Size**: 669KB (685,056 bytes)

**Size on disk**: 669KB (688,128 bytes)

**Modified**: Thursday, November 26, 2020, 1.11.36 AM

**TargetFramework**:  .NETFramework,Version=v4.0

**Assembly title**: Aku Form

**Assembly company**: Vendetta Inc.

**Assembly product**: Aku form

## File hashes
[Executable]

**MD5**: fabea57872e14b1facc1f3ff573ae6b9

**SHA1**: d790a7ba0dbe886ca05580eb7f3bd47e7b5879ab

**CRC32**: c7d7b2c9

**SHA256**: ae6c488302c04f00a60835db6b955fb8e1eb42f0e73e71873f5b7dc630596755

**SHA384**: 4e738ef21d879ec6d63021800f8fb8825e76b15f194047a0a2cec7e1d61688bc228d776705ef4dd23b9773d220f083e4

**SHA512**: 7ff1e78602417a2f7b1ccc9e2025851827aef1735605377e48a13a9fc629dffed7cea4262335741a86b82609c7d1b5fdc8a45fd9d611bbdf4fcca0bed98b59b7

**SSDEEP**: 12288:UH7b4JO34rN2iNoE3Scx6RbNwKqMDzI+uS6Bn7to6y4Tu4YqEoEt8LF:wb4JO3KN1Lshp5ZbX4K5f8

**human-hash**: mars-happy-nebraska-mars

## Anti-virus indentifiers
- Agent Tesla


# Dependencies
## Supported OS
.NET,Crossplatform
## Required libraries
.NET
## Configuration file/s
None
## Script/s and Executable/s
The dropped executables are obfuscated with various techniques.
## Url/s


# Sample identification
## Infection capabilities
Drop Agent Tesla, Keylogger.
## Self-preservation capacity
Looks for VMWare Tools registry key.
Looks for VirtualBox Guest Additions in registry.
Query disk information:
- \REGISTRY\MACHINE\SYSTEM\ControlSet001\Services\Disk\Enum
- \REGISTRY\MACHINE\SYSTEM\ControlSet001\services\Disk\Enum\0


## Data leakage abilities
Checks BIOS information in registry:
- \REGISTRY\MACHINE\HARDWARE\DESCRIPTION\System\SystemBiosVersion
- \REGISTRY\MACHINE\HARDWARE\DESCRIPTION\System\VideoBiosVersion

Reads data files stored by FTP clients.
Reads user/profile data of local email clients.
Reads user/profile data of web browsers.
## Remote attacker interactions / C&C
[Unfortunately can't analyze these types of informations at the moment]


# Observations
## Behavioral analysis
Modifies registry key.
EnumeratesProcesses.
AdjustPrivilegeToken.
SetWindowsHookEx.
WriteProcessMemory [**Target**: schtasks.exe].
## Code analysis
The code at first look seems a normal and benign executable. [See images for better comprehension]
Looking at the resources we find two suspicious samples:
- An image named: "tgjHD"
- A string named: "قوەرتیئحۆاسدفگهژکلزخجڤبنم" [Base64Url encoded executable]

The method with the role of initializing the malicious behaviour is: 
- `void dddddddddddd()` contained in the class `LoginForm()` contained in the namespace `SimpleTextEditor`
![](https://github.com/Finch4/Malware-Analysis-Reports/blob/main/03.01.2021/Agent%20Tesla%20Dropper/method.PNG?raw=true)
The payload is first decoded using the function [UrlTokenDecode](https://docs.microsoft.com/en-us/dotnet/api/system.web.httpserverutility.urltokendecode?view=netframework-4.8 "UrlTokenDecode") being a UrlToken there will be some difference from the normal Base64 encoding (Thanks to [Suragch](https://stackoverflow.com/users/3681880/suragch "Suragch") for the explaination), so some characters will be replaced or removed:
Base64/Base64Url
"+"     -> "-"
"/"     -> " _"
"="  ->      (optional)

After decoded the assembly will be loaded by the [Assembly.Load()](https://docs.microsoft.com/en-us/dotnet/api/system.reflection.assembly.load?view=net-5.0 "Assembly.Load()") method, after [LateBinding.LateGet()](https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualbasic.compilerservices.latebinding.lateget?view=net-5.0 "LateBinding.LateGet()") will be called passing as parameters  "GetMethod" and Buta", so the malware will try to get the method Buta after another call to the method will be performed [LateBinding.Get()](https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualbasic.compilerservices.latebinding.lateget?view=net-5.0 "LateBinding.Get()") and passing as parameters "Invoke" and `this.qqqqqqqqqqqqqqqqqqqqqqqqqqqqq` -> return an object array `[Arrrr.DAD,Arrrr.MOM,"Aku"]`, where `Arrrr.DAD` is the string "tgjHD" and, `Arrrr.MOM` is the string "eskGPRR", ![](https://github.com/Finch4/Malware-Analysis-Reports/blob/main/03.01.2021/Agent%20Tesla%20Dropper/object.PNG?raw=true) ![](https://github.com/Finch4/Malware-Analysis-Reports/blob/main/03.01.2021/Agent%20Tesla%20Dropper/strings.PNG?raw=true) we will see the the method `Buta` accept three strings parameters and will perform xor encoding and other types of encoding where the final objective is to extract some colors,pixel from the image (very interesting method) so we will se methods for RGB and other similar methods.

## Dynamic code analysis
None
## Memory analysis
None


# Supporting figures
## Logs
## Strings
## Function listings
## Screenshots
See images.
## Additional comments

