# Malware Analysis Report N°4


**Date**: 08/03/2021

**Author/s**: Finch


  * [Key observation](#key-observation)
  * [Indicators of compromise](#indicators-of-compromise)
  * [Delivery method](#delivery-method)
- [Sample identification](#sample-identification)
  * [File name, type, size](#file-name-type-size)
  * [File hashes](#file-hashes)
  * [Anti-virus indentifiers](#anti-virus-indentifiers)
- [Dependencies](#dependencies)
  * [Supported OS](#supported-os)
  * [Required libraries](#required-libraries)
  * [Configuration files](#configuration-files)
  * [Scripts and Executables](#scripts-and-executables)
  * [Network traffic](#network-traffic)
- [Sample identification](#sample-identification)
  * [Infection capabilities](#infection-capabilities)
  * [Self-preservation capacity](#self-preservation-capacity)
  * [Data leakage abilities](#data-leakage-abilities)
  * [Remote attacker interactions](#remote-attacker-interactions)
- [Observations](#observations)
  * [Behavioral analysis](#behavioral-analysis)
  * [Code analysis](#code-analysis)
  * [Dynamic code analysis](#dynamic-code-analysis)
  * [Memory analysis](#memory-analysis)
- [Supporting figures](#supporting-figures)
  * [Logs](#logs)
  * [Strings](#strings)
  * [Function listings](#function-listings)
  * [Screenshots](#screenshots)
  * [Additional comments](#additional-comments)

# Summary of the analysis

## Anti-virus indentifiers
- Azorult - [Azorult v3]

## Key observation
The sample try to compromise the analysis by looking as a benign executable.

3 Layers of protection [.NET].

Accoring to other information, if the final payload is written in Delphi, it is AZORult v3. [Analysis By Rewterz](https://www.rewterz.com/articles/malware-analysis-azorult-info-stealer)

## Indicators of compromise

Drop: `tmpC04A.tmp` in `C:\Users\user\AppData\Local\Temp\`

Persistence: `C:\Users\user\AppData\Local\Temp\tmpC04A.tmp` -> [ID: T1053Sub-techniques:  T1053.001, T1053.002, T1053.003, T1053.004, T1053.005, T1053.006 Tactics: Execution, Persistence, Privilege Escalation](https://attack.mitre.org/techniques/T1053/)



## Delivery method

The delivery is made by email

Email example(Thanks to [abuse_ch](https://bazaar.abuse.ch/user/41587972/)):

Malspam distributing AZORult:

**HELO**: n1nlsmtp01.shr.prod.ams1.secureserver.net

**Sending IP**: 188.121.43.201

**From**: contact.mlfunding@gmail.com

**Reply-To**: gregoryryan001@gmail.com

**Subject**: Quote new order

**Attachment**: New order quote.img (contains "Quote.exe")

**AZORult C2**:
hxxp://elovisboy[.]com/PL341/index.php


# Sample identification
## File name, type, size

**File name**: Quote.exe

**Type**: .NET

**Size**: 633KB (648,704 bytes)

**Size on disk**: 636KB (651,264 bytes)

**TargetFramework**:  .NETFramework,Version=v4.0

**Assembly title**: SecurityContextRunData

**Assembly company**: 

**Assembly product**: SecurityContextRunData

**Guid**: 053852B6-246b-4853-a574-b33a4893a1b6 -> [GUID](https://docs.microsoft.com/en-us/dotnet/api/system.guid?view=net-5.0#remarks)

## File hashes
**[First Layer]**

**MD5**: a2c12e1cb2edc764a914e1bbb15ebddd

**SHA1**: 034711671b3390efae46fd94029f0386601a5b76

**SHA256**: 88cc05b70c391a2c1ac1215bf9f2c09b7934015a9868c9467cb1801187bbf97b

**SHA3-384**: d0f25bf13ef03a9516bf2dc088466d8de5c7b217a6058211dd6956cc72117601f1077642a86066a2718fc26b49782c3e

**VHASH**: 265036755513007268585360

**AUTHENTIHASH**: 6f85dcbb68844a37ef67b6d51090c8088a7845bf945eaea1775560688ad5bd40

**IMPHASH**: f34d5f2d4577ed6d9ceec516c1f5a744

**SSDEEP**: 12288:mHacr+aND6M5+9JWYZxL5RwFZE9wKnEViVmgR6rlyYzjqpWfGedl75SURV5p1bZf:mHn+ah6PJWZo9VkZFR

**TLSH**: T14BD417ACF71172AEC41BC9B2D954FCA0EAA47867E30B834790D325D99B2C557EF500B2

**human-hash**: william-washington-jersey-twelve [Statistical uniqueness is only around 1 in 4.3 billion]

# Dependencies

## Supported OS

.NET [The target is Windows]

## Required libraries

.NET

## Configuration files

None

## Scripts and Executables

## Network traffic

**DNS**: elovisboy[.]com -> **POST REQUEST**: hxxp://elovisboy[.]com/PL341/index.php


# Sample identification
## Infection capabilities
Stealer, Keylogger [MalPedia](https://malpedia.caad.fkie.fraunhofer.de/details/win.azorult)

## Self-preservation capacity
Tries to detect virtual machine -> `HARDWARE\DESCRIPTION\System\CentralProcessor\0` ->  MITRE ATT&CK: [ID: T1497.001 Sub-technique of:  T1497 Tactics: Defense Evasion, Discovery](https://attack.mitre.org/techniques/T1497/001/)

Base64 Encoded strings to avoid detection. [See image n°]


## Data leakage abilities

Steal browsers / programs credential

**Some Base64 Decoded Strings**: `['Software\Microsoft\Windows\CurrentVersion\Uninstal', 'HARDWARE\DESCRIPTION\System\CentralProcessor\0', 'CreateToolhelp32Snapshot'[1*], 'Process32FirstW'[1*], 'Process32NextW'[1*]]`

**Mozilla Places Database Exploration Via SQL**:
![](https://media.prod.mdn.mozit.cloud/attachments/2018/03/27/15838/44f520cb6cdd7978f6a3e14b701912b8/places-erd.png)
[](https://wiki.mozilla.org/images/d/d5/Places.sqlite.schema3.pdf)

## Remote attacker interactions

hxxp://elovisboy[.]com/PL341/index.php

# Observations
## Behavioral analysis

## Code analysis

## Dynamic Code Analysis

3 Layers of unpacking.

Dynamic imports [See screenshot n°]

## Memory analysis
None


# Supporting figures
## Logs
## Strings
## Function listings

## Screenshots

![AZORult Unpacking 1](https://github.com/Finch4/Malware-Analysis-Reports/blob/main/AZORult/88cc05b70c391a2c1ac1215bf9f2c09b7934015a9868c9467cb1801187bbf97b/AzoRultUnpacking1.PNG?raw=true)

![AZORult Unpacking 2](https://github.com/Finch4/Malware-Analysis-Reports/blob/main/AZORult/88cc05b70c391a2c1ac1215bf9f2c09b7934015a9868c9467cb1801187bbf97b/AzoRultUnpacking2.PNG?raw=true)

![AZORult PE](https://github.com/Finch4/Malware-Analysis-Reports/blob/main/AZORult/88cc05b70c391a2c1ac1215bf9f2c09b7934015a9868c9467cb1801187bbf97b/AZORultPE.PNG?raw=true)

## Additional comments

[1*] These strings suggest dynamic imports.
